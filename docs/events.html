<!DOCTYPE html>
<html lang="es">
<head>
    <link rel="icon" type="image/png" sizes="32x32" href="img/logos/logo-wie.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/logos/logo-wie.png">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>WIE UPRM ‚Äì Eventos</title>
    <link rel="stylesheet" href="css/style.css" />
    <style>
        /* ‚Äî‚Äî Tabs ‚Äî‚Äî */
        .tabs {
          display: flex;
          justify-content: center;
          gap: 1rem;
          margin: 2rem 0;
        }
        .tabs button {
          padding: .75rem 1.5rem;
          border: none;
          background: var(--accent2);
          color: var(--text);
          font-size: 1rem;
          cursor: pointer;
          border-radius: 4px;
          transition: background .2s;
        }
        .tabs button.active {
          background: var(--purple);
          color: #fff;
        }

        /* ‚Äî‚Äî Tab Contents ‚Äî‚Äî */
        .tab-content {
          display: none;
          max-width: 800px;
          margin: 0 auto 3rem;
        }
        .tab-content.active {
          display: block;
        }

        /* ‚Äî‚Äî Timeline ‚Äî‚Äî */
        .timeline {
          position: relative;
          margin: 2rem 0;
          padding-left: 2rem;
        }
        .timeline::before {
          content: '';
          position: absolute;
          left: 15px; top:0; bottom:0;
          width: 4px;
          background: var(--accent1);
          border-radius: 2px;
        }
        .timeline-event {
          position: relative;
          margin-bottom: 2rem;
          padding-left: 2rem;
        }
        .timeline-event::before {
          content: '';
          position: absolute;
          left: 8px; top:5px;
          width: 14px; height: 14px;
          background: var(--purple);
          border-radius: 50%;
          border: 3px solid #fff;
          box-shadow: 0 0 0 2px var(--accent1);
        }
        .timeline-event h3 {
          margin: 0; font-size: 1.25rem; color: var(--purple);
        }
        .timeline-event time {
          font-size: .9rem; color: #666;
        }
        .timeline-event p {
          margin: .5rem 0 1rem;
        }
        .timeline-event .btn.small {
          font-size: .9rem; padding: .4rem .8rem;
        }

        /* ‚Äî‚Äî Calendar ‚Äî‚Äî */
        .calendar-wrapper {
          box-shadow: 0 2px 8px rgba(0,0,0,0.1);
          border-radius: 4px;
          overflow: hidden;
        }
        .calendar-wrapper iframe {
          width: 100%; height: 650px; border: none;
        }

        /* ‚Äî‚Äî Modals ‚Äî‚Äî */
        .modal {
          display: none;
          position: fixed;
          top: 0; left: 0;
          width: 100%; height: 100%;
          background: rgba(0,0,0,0.6);
          align-items: center; justify-content: center;
          z-index: 100;
        }
        .modal.active {
          display: flex;
        }
        .modal-content {
          background: #fff;
          border-radius: 8px;
          max-width: 500px;
          width: 90%;
          padding: 2rem;
          position: relative;
        }
        .modal-content h2 {
          margin-top: 0;
          color: var(--purple);
        }
        .modal-content p {
          margin: 1rem 0;
          line-height: 1.5;
        }
        .modal-close {
          position: absolute;
          top: .5rem; right: .5rem;
          background: none;
          border: none;
          font-size: 1.5rem;
          cursor: pointer;
          color: #666;
        }
        .modal-close:hover { color: #000; }

        /* ‚Äî‚Äî Helpers ‚Äî‚Äî */
        .muted { color:#777; font-size:.95rem; }
        .center { text-align:center; }
        .spinner {
          width: 30px; height: 30px; border-radius: 50%;
          border: 3px solid rgba(0,0,0,.1);
          border-top-color: var(--purple);
          animation: spin 1s linear infinite;
          margin: 1rem auto;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<!-- Header + Navigation -->
<header class="site-header">
    <div class="container header-container">
        <a href="index.html" class="logo">
            <img src="img/logos/logo-wie.png" alt="IEEE WIE UPRM Logo">
        </a>
        <nav class="main-nav">
            <ul class="nav-links" id="nav-links">
                <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
                <li class="nav-item dropdown">
                    <a href="about.html" class="nav-link">About Us</a>
                    <ul class="dropdown-menu">
                        <li><a href="board.html"      class="dropdown-link">Directive Board</a></li>
                        <li><a href="star.html"       class="dropdown-link">STAR Program</a></li>
                        <li><a href="wip.html"        class="dropdown-link">Women In Power</a></li>
                        <li><a href="flordemaga.html" class="dropdown-link">Flor de Maga</a></li>
                    </ul>
                </li>
                <li class="nav-item"><a href="events.html" class="nav-link active">Events</a></li>
                <li class="nav-item"><a href="sponsors.html" class="nav-link">Sponsors</a></li>
                <li class="nav-item dropdown">
                    <a href="contact.html" class="nav-link">Contact Us</a>
                    <ul class="dropdown-menu">
                        <li><a href="contact.html" class="dropdown-link">Contact Form</a></li>
                        <li><a href="faq.html" class="dropdown-link">Frequently Asked Questions</a></li>
                    </ul>
                </li>
            </ul>
            <form class="search-form" action="search.html" method="get" role="search">
                <input type="text" name="q" placeholder="Search‚Ä¶" aria-label="Search">
                <button type="submit" aria-label="Submit search">üîç</button>
            </form>
            <button class="menu-toggle" id="menu-toggle" aria-label="Toggle menu">
                <span></span><span></span><span></span>
            </button>
        </nav>
    </div>
</header>

<main class="container">
    <h1 class="center" style="color:var(--purple);margin-top:2rem;">Eventos</h1>

    <!-- ‚Äî‚Äî Tabs ‚Äî‚Äî -->
    <div class="tabs">
        <button data-tab="timeline" class="active">Timeline</button>
        <button data-tab="calendar">Calendario</button>
    </div>

    <!-- ‚Äî‚Äî Timeline ‚Äî‚Äî -->
    <section id="timeline" class="tab-content active">
        <div id="timeline-loading" class="center">
            <div class="spinner" aria-hidden="true"></div>
            <p class="muted">Cargando eventos‚Ä¶</p>
        </div>
        <div class="timeline" id="timeline-list" aria-live="polite"></div>
        <p id="timeline-empty" class="center muted" style="display:none;">No hay eventos pr√≥ximos en el calendario.</p>
    </section>

    <!-- ‚Äî‚Äî WIE Embed Calendar ‚Äî‚Äî -->
    <section id="calendar" class="tab-content">
        <div class="calendar-wrapper">
            <iframe src="https://calendar.google.com/calendar/embed?src=wie%40uprm.edu&ctz=America%2FPuerto_Rico"></iframe>
        </div>
    </section>
</main>

<!-- Footer -->
<footer>
    <div class="container">
        <p>&copy; 2025 IEEE Women in Engineering UPRM Student Branch. All rights reserved.</p>
    </div>
</footer>

<!-- ‚Äî‚Äî Scripts ‚Äî‚Äî -->
<script>
    // Tabs
    document.querySelectorAll('.tabs button').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelector('.tabs .active').classList.remove('active');
        btn.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
        document.getElementById(btn.dataset.tab).classList.add('active');
      });
    });

    // Mobile menu
    document.getElementById('menu-toggle').addEventListener('click', () => {
      document.getElementById('nav-links').classList.toggle('open');
    });

    // ====== TIMELINE DIN√ÅMICO DESDE data/events.json ======
    (async function loadEvents() {
      const listEl = document.getElementById('timeline-list');
      const loadingEl = document.getElementById('timeline-loading');
      const emptyEl = document.getElementById('timeline-empty');

      try {
        const res = await fetch('data/events.json', { cache: 'no-store' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const raw = await res.json();

        // Normaliza array
        const events = Array.isArray(raw) ? raw : (raw.events || []);

        // Filtra pr√≥ximos: end >= hoy 00:00 local
        const todayStart = new Date();
        todayStart.setHours(0,0,0,0);

        const upcoming = events
          .map(ev => ({
            ...ev,
            startDate: new Date(ev.start),
            endDate: ev.end ? new Date(ev.end) : new Date(ev.start)
          }))
          .filter(ev => ev.endDate >= todayStart)
          .sort((a,b) => a.startDate - b.startDate);

        // Limpia loader
        loadingEl.style.display = 'none';

        if (upcoming.length === 0) {
          emptyEl.style.display = 'block';
          return;
        }

        // Formateador fecha ES-PR
        const fmt = new Intl.DateTimeFormat('es-PR', {
          weekday: 'long', year: 'numeric', month: 'long', day: 'numeric',
          hour: '2-digit', minute: '2-digit'
        });

        // Construye eventos + modales
        const frag = document.createDocumentFragment();
        const modalFrag = document.createDocumentFragment();

        upcoming.forEach((ev, idx) => {
          const id = 'ev_' + (ev.uid || idx);
          const title = ev.summary || 'Evento';
          const when = ev.allDay
            ? new Intl.DateTimeFormat('es-PR', { year:'numeric', month:'long', day:'numeric' }).format(ev.startDate)
            : fmt.format(ev.startDate);

          const item = document.createElement('div');
          item.className = 'timeline-event';
          item.innerHTML = `
            <h3>${escapeHtml(title)}</h3>
            <time datetime="${ev.startDate.toISOString()}">${capitalize(when)}</time>
            ${ev.location ? `<p class="muted">${escapeHtml(ev.location)}</p>` : ''}
            ${(ev.description && ev.description.trim()) || ev.url ? `
              <button class="btn small" data-modal="${id}">M√°s detalles ‚Üí</button>
            ` : ''}
          `;
          frag.appendChild(item);

          if ((ev.description && ev.description.trim()) || ev.url) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = id;
            modal.innerHTML = `
              <div class="modal-content">
                <button class="modal-close" aria-label="Cerrar">&times;</button>
                <h2>${escapeHtml(title)}</h2>
                <p><strong>Cu√°ndo:</strong> ${capitalize(when)}</p>
                ${ev.location ? `<p><strong>D√≥nde:</strong> ${escapeHtml(ev.location)}</p>` : ''}
                ${ev.description ? `<p>${linkify(escapeHtml(ev.description)).replace(/\n/g,'<br>')}</p>` : ''}
                ${ev.url ? `<p><a href="${ev.url}" target="_blank" rel="noopener">Ver en Calendario ‚Üí</a></p>` : ''}
              </div>
            `;
            modalFrag.appendChild(modal);
          }
        });

        listEl.appendChild(frag);
        document.body.appendChild(modalFrag);

        // Wire modals
        document.querySelectorAll('[data-modal]').forEach(btn => {
          btn.addEventListener('click', () => {
            const m = document.getElementById(btn.dataset.modal);
            if (m) m.classList.add('active');
          });
        });
        document.querySelectorAll('.modal-close').forEach(x => {
          x.addEventListener('click', () => {
            x.closest('.modal').classList.remove('active');
          });
        });
        document.querySelectorAll('.modal').forEach(modal => {
          modal.addEventListener('click', e => {
            if (e.target === modal) modal.classList.remove('active');
          });
        });

      } catch (err) {
        // Fallback si falla el fetch
        loadingEl.style.display = 'none';
        listEl.innerHTML = `
          <div class="timeline-event">
            <h3>No se pudieron cargar los eventos</h3>
            <p class="muted">Revisa que <code>data/events.json</code> exista y que GitHub Pages sirva la √∫ltima versi√≥n.</p>
          </div>
        `;
        console.error('Error cargando eventos:', err);
      }

      // Utils
      function escapeHtml(s='') {
        return s.replace(/[&<>"']/g, m => (
          { '&':'&nbsp;&amp;'.slice(6), '<':'&lt;', '>':'&gt;', '"':'&quot;', "'":'&#39;' }[m]
        ));
      }
      function linkify(text='') {
        const urlRE = /(https?:\/\/[^\s)]+)|(www\.[^\s)]+)/gi;
        return text.replace(urlRE, (match) => {
          const href = match.startsWith('http') ? match : 'http://' + match;
          return `<a href="${href}" target="_blank" rel="noopener">${match}</a>`;
        });
      }
      function capitalize(str='') {
        return str.charAt(0).toUpperCase() + str.slice(1);
      }
    })();
</script>
</body>
</html>